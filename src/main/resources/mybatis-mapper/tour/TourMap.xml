<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.diden.demo.domain.tour.repository.TourMapper">
    <resultMap id="commonTourResponseDto" type="com.diden.demo.api.tour.dto.response.CommonTourResponseDto">
        <result column="AREACODE" property="areaCode"
                typeHandler="com.diden.demo.domain.tour.converter.AreaCodeConverterHandler"/>
        <result column="SERVICECONTENTTYPECODE" property="serviceContentTypeCode"
                typeHandler="com.diden.demo.domain.tour.converter.ContentTypeCodeConverterHandler"/>
        <result column="SERVICEHIGHCODE" property="serviceHighCode"
                typeHandler="com.diden.demo.domain.tour.converter.HighCodeConverterHandler"/>
        <result column="SERVICEMIDDLECODE" property="serviceMiddleCode"
                typeHandler="com.diden.demo.domain.tour.converter.MiddleCodeConverterHandler"/>
    </resultMap>

    <insert id="insertSigunguCode">
        insert into TB_SIGUNGU_CODE (CODE, NAME, AREA_CODE)
        values (#{code}, #{name}, #{areaCode})
    </insert>

    <select id="findAreaCodeList" resultType="com.diden.demo.domain.tour.vo.TourAreaCodeVo">
        select CODE, NAME, USE
        from TB_AREA_CODE
    </select>


    <select id="findSigunguCodeList" resultType="com.diden.demo.domain.tour.vo.TourSigunguCodeVo">
        select CODE,
               NAME,
               USE,
               AREA_CODE
        from TB_SIGUNGU_CODE
        where AREA_CODE = #{areaCode}
    </select>

    <select id="tourInfoList" resultType="com.diden.demo.domain.tour.vo.TourAreaInfoResponseDto">
        SELECT *
        FROM TB_AREA_TOUR_INFO
        WHERE 1=1
        <if test="cat1 != null and cat1 !=''">
            AND CAT1 = #{cat1}
        </if>
        <if test="cat2 != null and cat2 !=''">
            AND CAT2 = #{cat2}
        </if>
        <if test="cat3 != null and cat3 !=''">
            AND CAT3 = #{cat3}
        </if>
        <if test="keyword != null and keyword !=''">
            AND TITLE LIKE '%' || #{keyword} || '%'
        </if>
    </select>

    <select id="newTourInfoList" resultMap="commonTourResponseDto">
        SELECT CONTENTID,
        CONTENTTYPEID serviceContentTypeCode,
        TITLE,
        ADDR1,
        ADDR2,
        CAT1 serviceHighCode,
        CAT2 serviceMiddleCode,
        CAT3 serviceLowCode,
        FIRSTIMAGE,
        FIRSTIMAGE2,
        MAPX,
        MAPY,
        READCOUNT,
        SIGUNGUCODE,
        TEL,
        ZIPCODE,
        CREATEDTIME,
        MODIFIEDTIME,
        AREACODE,
        MLEVEL,
        OVERVIEW
        FROM TB_AREA_TOUR_INFO
        <where>
            <if test="serviceHighCode != null">
                AND CAT1 = #{serviceHighCode.code}
            </if>
            <if test="serviceMiddleCode != null">
                AND CAT2 = #{serviceMiddleCode.code}
            </if>
            <if test="serviceLowCode != null">
                AND CAT3 = #{serviceLowCode}
            </if>
            <if test="keyword != null">
                AND TITLE LIKE '%' || #{keyword} || '%'
            </if>
        </where>
    </select>

    <select id="newTourInfoListTest" resultMap="commonTourResponseDto">
        select *
        from TB_TOUR_INFO
        <where>
            <if test="contentTypeId != null">
                SERVICECONTENTTYPECODE = #{contentTypeId}
            </if>
            <if test="areaCode != null">
                AREACODE = #{areaCode}
            </if>

        </where>
    </select>

    <select id="newSigunguCodeList" parameterType="_integer" resultType="com.diden.demo.domain.tour.vo.TourSigunguCodeVo">
        select CODE,
               NAME,
               USE
        from TB_SIGUNGU_CODE
        where AREA_CODE = #{areaCode}
    </select>

    <insert id="tourInfoInsert" parameterType="map">
        INSERT INTO TB_AREA_TOUR_INFO ( ADDR1
                                      , ADDR2
                                      , AREACODE
                                      , CAT1
                                      , CAT2
                                      , CAT3
                                      , CONTENTID
                                      , CONTENTTYPEID
                                      , CREATEDTIME
                                      , FIRSTIMAGE
                                      , MAPX
                                      , MAPY
                                      , MLEVEL
                                      , MODIFIEDTIME
                                      , SIGUNGUCODE
                                      , TEL
                                      , TITLE
                                      , ZIPCODE)
        VALUES ( #{addr1}
               , #{addr2}
               , #{areacode}
               , #{cat1}
               , #{cat2}
               , #{cat3}
               , #{contentid}
               , #{contenttypeid}
               , #{createdtime}
               , #{firstimage}
               , #{mapx}
               , #{mapy}
               , #{mlevel}
               , #{modifiedtime}
               , #{sigungucode}
               , #{tel}
               , #{title}
               , #{zipcode})
    </insert>

    <update id="tourInfoUpdate" parameterType="map">
        UPDATE TB_AREA_TOUR_INFO
        SET ADDR1         = #{addr1}
          , ADDR2         = #{addr2}
          , AREACODE      = #{areacode}
          , CAT1          = #{cat1}
          , CAT2          = #{cat2}
          , CAT3          = #{cat3}
          , CONTENTID     = #{contentid}
          , CONTENTTYPEID = #{contenttypeid}
          , CREATEDTIME   = #{createdtime}
          , FIRSTIMAGE    = #{firstimage}
          , MAPX          = #{mapx}
          , MAPY          = #{mapy}
          , MLEVEL        = #{mlevel}
          , MODIFIEDTIME  = #{modifiedtime}
          , SIGUNGUCODE   = #{sigungucode}
          , TEL           = #{tel}
          , TITLE         = #{title}
          , ZIPCODE       = #{zipcode}
          , OVERVIEW = #{overview}
        WHERE CONTENTID = #{contentid}
    </update>

    <update id="tourInfoOverViewUpdate" parameterType="map">
        update TB_AREA_TOUR_INFO set OVERVIEW = #{overview} where CONTENTID = #{contentid}
    </update>

    <delete id="tourInfoDelete">
        DELETE
        FROM TB_AREA_TOUR_INFO
    </delete>

    <update id="newTourInfoInsert">
        <foreach collection="list" open="INSERT ALL" close="SELECT * FROM DUAL" item="receiver" separator=" ">
        INTO TB_TOUR_INFO (
        CONTENTID,
        SERVICECONTENTTYPECODE,
        TITLE,
        ADDR1,
        ADDR2,
        SERVICEHIGHCODE,
        SERVICEMIDDLECODE,
        SERVICELOWCODE,
        FIRSTIMAGE,
        FIRSTIMAGE2,
        MAPX,
        MAPY,
        READCOUNT,
        SIGUNGUCODE,
        TEL,
        ZIPCODE,
        CREATEDTIME,
        MODIFIEDTIME,
        AREACODE,
        MLEVEL,
        OVERVIEW,
        DIST,
        EVENTSTARTDATE,
        EVENTENDDATE,
        BENIYN,
        GDSTYN,
        TRDITHANOKYN,
        HMPG,
        BOOKTOUR,
        TELNAME
        ) VALUES
            (
                 #{receiver.contentId},
                #{receiver.serviceContentTypeCode.name},
                #{receiver.title},
                #{receiver.addr1},
                #{receiver.addr2},
                #{receiver.serviceHighCode.name},
                #{receiver.serviceMiddleCode.name},
                #{receiver.serviceLowCode},
                #{receiver.firstImage},
                #{receiver.firstImage2},
                #{receiver.mapx},
                #{receiver.mapy},
                #{receiver.readcount},
                #{receiver.sigungucode},
                #{receiver.tel},
                #{receiver.zipcode},
                #{receiver.createdTime},
                #{receiver.modifiedTime},
                #{receiver.areaCode.name},
                #{receiver.mlevel},
                #{receiver.overview},
                #{receiver.dist},
                #{receiver.eventstartdate},
                #{receiver.eventenddate},
                #{receiver.beniYN},
                #{receiver.gdstYN},
                #{receiver.trditHanokYN},
                #{receiver.hmpg},
                #{receiver.booktour},
                #{receiver.telname}
            )
        </foreach>
    </update>

    <update id="newTourInfoInsertTest" parameterType="map">
        <foreach collection="list" open="INSERT ALL" close="SELECT * FROM DUAL" item="receiver" separator=" ">
        INTO TB_TOUR_INFO (
        CONTENTID,
        SERVICECONTENTTYPECODE,
        TITLE,
        ADDR1,
        ADDR2,
        SERVICEHIGHCODE,
        SERVICEMIDDLECODE,
        SERVICELOWCODE,
        FIRSTIMAGE,
        FIRSTIMAGE2,
        MAPX,
        MAPY,
        READCOUNT,
        SIGUNGUCODE,
        TEL,
        ZIPCODE,
        CREATEDTIME,
        MODIFIEDTIME,
        AREACODE,
        MLEVEL,
        OVERVIEW,
        DIST,
        EVENTSTARTDATE,
        EVENTENDDATE,
        BENIYN,
        GDSTYN,
        TRDITHANOKYN,
        HMPG,
        BOOKTOUR,
        TELNAME
        ) VALUES
            (
                #{receiver.contentid},
                #{receiver.contenttypeid},
                #{receiver.title},
                #{receiver.addr1},
                #{receiver.addr2},
                #{receiver.cat1},
                #{receiver.cat2},
                #{receiver.cat3},
                #{receiver.firstimage},
                #{receiver.firstimage2},
                #{receiver.mapx},
                #{receiver.mapy},
                #{receiver.readcount},
                #{receiver.sigungucode},
                #{receiver.tel},
                #{receiver.zipcode},
                #{receiver.createdtime},
                #{receiver.modifiedtime},
                #{receiver.areacode},
                #{receiver.mlevel},
                #{receiver.overview},
                #{receiver.dist},
                #{receiver.eventstartdate},
                #{receiver.eventenddate},
                #{receiver.beniYN},
                #{receiver.gdstYN},
                #{receiver.trditHanokYN},
                #{receiver.hmpg},
                #{receiver.booktour},
                #{receiver.telname}
            )
        </foreach>
    </update>
</mapper>